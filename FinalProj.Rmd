---
title: "Final Project"
author: "Hope Kudo"
date: "11/6/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(shiny)
library(tidyverse)
library(ggplot2)
library(atus)
library(shinythemes)
library(skimr)
library(readxl)
library(janitor)
library(dplyr)
```

```{r}
cps <- atuscps
time <- atusact
resp <- atusresp

#join cpc and resp files together by respondent's ID number

table <- left_join(cps, resp, by = c("tucaseid")) %>% 
select(tucaseid, region, state, sex, age, edu, diary_mo, diary_day, race, famincome, tuyear, occup_code, labor_status, student_status,hh_size) %>%
  filter(tuyear == c("2015", "2016")) %>%
  #filter(diary_mo == "1", diary_day == "26") %>%
  distinct()


# Change NA to 0 for duration & activity minutes 

#data$housework[which(is.na(data$housework))] <- 0 

#table[["dur"]][is.na(table[["duration"]])] <- 0
#summary(table$dur)

```

```{r}
#Add variables as columns to dataframe
#Sleep
sleep <- time %>%
  ungroup() %>% 
  filter(tiercode == 10101)

a <- left_join(table, sleep, by = c("tucaseid")) %>%
  mutate(sleep = dur) 
a = subset(a, select = -c(tiercode, dur)) 

#how to change minutes to hours

#Housework
housework <- time %>%
  ungroup() %>% 
  filter(between(tiercode, 20101, 20199))

b <- left_join(a, housework, by = c("tucaseid")) %>%
  mutate(housework = dur) 
b = subset(b, select = -c(tiercode, dur)) 

#Telephone
phonetime <- time %>%
  ungroup() %>% 
  filter(between(tiercode, 160101, 169989))

c <- left_join(b, telephone, by = c("tucaseid")) %>%
  mutate(phonetime = dur) 
c = subset(c, select = -c(tiercode, dur))

#Volunteer
volunteer <- time %>%
  ungroup() %>% 
  filter(between(tiercode, 150101, 159989))

d <- left_join(c, volunteer, by = c("tucaseid")) %>%
    mutate(volunteer = dur) 
d = subset(d, select = -c(tiercode, dur))

#Playing Sports
sports <- time %>%
  ungroup() %>% 
  filter(between(tiercode, 130101, 130199))

e <- left_join(d, sports, by = c("tucaseid")) %>%
      mutate(sports = dur) 
e = subset(e, select = -c(tiercode, dur))

#Religious Activities
religion <- time %>%
  ungroup() %>% 
  filter(between(tiercode, 140101, 149999))

f <- left_join(e, religion, by = c("tucaseid")) %>%
      mutate(religion = dur) 
f = subset(f, select = -c(tiercode, dur))

#Eating Meals
eating <- time %>%
  ungroup() %>% 
  filter(between(tiercode, 110101, 119999))

g <- left_join(f, eating, by = c("tucaseid")) %>%
        mutate(eating = dur) 
g = subset(g, select = -c(tiercode, dur))

#Shopping
shopping <- time %>%
  ungroup() %>% 
  filter(between(tiercode, 70101, 70199))

h <- left_join(g, shopping, by = c("tucaseid")) %>%
          mutate(shopping = dur) 
h = subset(h, select = -c(tiercode, dur))

#Research and Homework
research_homework <- time %>%
  ungroup() %>% 
  filter(between(tiercode, 60301, 60399))

i <- left_join(h, research_homework, by = c("tucaseid")) %>%
            mutate(research_homework = dur) 
i = subset(i, select = -c(tiercode, dur))

#Classtime
class <- time %>%
  ungroup() %>% 
  filter(between(tiercode, 60101, 60199))

j <- left_join(i, class, by = c("tucaseid")) %>%
              mutate(class = dur) 
j = subset(j, select = -c(tiercode, dur))

#Working 
working <- time %>%
  ungroup() %>% 
  filter(between(tiercode, 50101, 59999))

k <- left_join(j, working, by = c("tucaseid")) %>%
              mutate(working = dur) 
k = subset(k, select = -c(tiercode, dur))

#Socializing
socialevents <- time %>%
  ungroup() %>% 
  filter(between(tiercode, 120201, 120299 | 129999))

l <- left_join(k, socialevents, by = c("tucaseid")) %>%
                mutate(socialevents = dur) 
l = subset(l, select = -c(tiercode, dur))

#Television
tv <- time %>%
  ungroup() %>%
  filter(between(tiercode, 120303, 120304))

m <- left_join(l, tv, by = c("tucaseid")) %>%
                mutate(tv = dur) 
m = subset(m, select = -c(tiercode, dur))

#Drug Use
druguse <- time %>%
  ungroup() %>% 
  filter(tiercode == 120302)

n <- left_join(m, tv, by = c("tucaseid")) %>%
                mutate(druguse = dur) 
n = subset(n, select = -c(tiercode, dur))

#Computer Usage
computeruse <- time %>%
  ungroup() %>% 
  filter(tiercode == 120308)

o <- left_join(n, computeruse, by = c("tucaseid")) %>%
                mutate(computeruse = dur) 
o = subset(o, select = -c(tiercode, dur))

#Get rid of duplicate rows
data <- o %>%
  distinct() 
data <- data[!duplicated(data$tucaseid), ]

#add to each variable
data$housework[which(is.na(data$housework))] <- 0 

#change min to hours
data$housework <- data$housework / 60



```



#write.csv(o, "50proj/2016.csv")

#HI <- o %>%
#filter(state == "HI", tuyear == 2016)
#how to change minutes (dur) into hours


```

```{r p2}
test <- o %>%
  select(state, sleeping) %>%
  group_by(state) %>%
  mutate(mean_sleep = mean(sleep))
```

dfsleeping <- df1 %>%
  select(state, mean_sleeping) %>%
  distinct()


df2 <- data %>%
  select(state, housework) %>%
  group_by(state) %>%
  mutate(mean_housework = mean(housework))

dfhousework <- df2 %>%
  select(state, mean_housework) %>%
  distinct()

idk <- left_join(dfhousework, dfsleeping, by = c("state"))


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
